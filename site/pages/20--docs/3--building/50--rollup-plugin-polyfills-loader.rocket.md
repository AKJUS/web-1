```js server
/* START - Rocket auto generated - do not touch */
// prettier-ignore
export const sourceRelativeFilePath = '20--docs/3--building/50--rollup-plugin-polyfills-loader.rocket.md';
import { html, layout, setupUnifiedPlugins, components } from '../../recursive.data.js';
export { html, layout, setupUnifiedPlugins, components };
export async function registerCustomElements() {
  // server-only components
  // prettier-ignore
  customElements.define('rocket-social-link', await import('@rocket/components/social-link.js').then(m => m.RocketSocialLink));
  // prettier-ignore
  customElements.define('rocket-header', await import('@rocket/components/header.js').then(m => m.RocketHeader));
  // prettier-ignore
  customElements.define('main-docs', await import('@rocket/components/main-docs.js').then(m => m.MainDocs));
  // hydrate-able components
  // prettier-ignore
  customElements.define('rocket-search', await import('@rocket/search/search.js').then(m => m.RocketSearch));
  // prettier-ignore
  customElements.define('rocket-drawer', await import('@rocket/components/drawer.js').then(m => m.RocketDrawer));
}
/* END - Rocket auto generated - do not touch */
```

# Rollup Plugin Polyfills Loader

Rollup plugin for injecting a [Polyfills Loader](./polyfills-loader.md) into a HTML file generated by [@web/rollup-plugin-html](./rollup-plugin-html.md).

## Examples

### Basic rollup build

With a single build output a runtime loader is injected to load polyfills on browsers which don't support certain features.

```js
import html from '@web/rollup-plugin-html';
import polyfillsLoader from '@web/rollup-plugin-polyfills-loader';

export default {
  output: { dir: 'dist' },
  plugins: [
    html({ input: 'index.html' }),
    polyfillsLoader({
      polyfills: {
        coreJs: true,
        fetch: true,
        webcomponents: true,
      },
    }),
  ],
};
```

### Multiple rollup build outputs

When you have multiple rollup build outputs, the polyfills loader can load the modern or legacy build based on the browser.

```js
import html from '@web/rollup-plugin-html';
import polyfillsLoader from '@web/rollup-plugin-polyfills-loader';

// create an instance of the HTML plugin
const htmlPlugin = html({ input: 'index.html' });

export default {
  output: [
    {
      format: 'system',
      chunkFileNames: 'nomodule-[name]-[hash].js',
      entryFileNames: 'nomodule-[name]-[hash].js',
      dir: 'dist',
      // add a legacy build child plugin
      plugins: [htmlPlugin.api.addOutput('legacy')],
    },
    {
      format: 'es',
      chunkFileNames: '[name]-[hash].js',
      entryFileNames: '[name]-[hash].js',
      dir: 'dist',
      // add a modern build child plugin
      plugins: [htmlPlugin.api.addOutput('modern')],
    },
  ],
  plugins: [
    htmlPlugin,
    polyfillsLoader({
      modernOutput: { name: 'modern' },
      legacyOutput: { name: 'legacy', test: "!('noModule' in HTMLScriptElement.prototype)" },
      polyfills: {
        coreJs: true,
        fetch: true,
        webcomponents: true,
      },
    }),
  ],
};
```

### External loader script

By default the polyfills loader script is inlined into the HTML. You can configure the plugin to create an external script:

```js
import html from '@web/rollup-plugin-html';
import polyfillsLoader from '@web/rollup-plugin-polyfills-loader';

export default {
  output: { dir: 'dist' },
  plugins: [
    html({ input: 'index.html' }),
    polyfillsLoader({
      polyfills: {
        coreJs: true,
        fetch: true,
        webcomponents: true,
      },
      externalLoaderScript: true,
    }),
  ],
};
```
